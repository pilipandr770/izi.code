{% extends "base.html" %}

{% block title %}{{ _('Home') }} - {{ super() }}{% endblock %}

{% block extra_head %}
<!-- Add hero animation CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/hero-animation.css') }}">
<style>
    /* Typing indicator animation */
    .typing-dots {
        display: inline-flex;
    }
    
    .typing-dots span {
        width: 8px;
        height: 8px;
        margin: 0 2px;
        background-color: #007bff;
        border-radius: 50%;
        opacity: 0.6;
        animation: typing-dot 1.4s infinite ease-in-out both;
    }
    
    .typing-dots span:nth-child(1) {
        animation-delay: 0s;
    }
    
    .typing-dots span:nth-child(2) {
        animation-delay: 0.2s;
    }
    
    .typing-dots span:nth-child(3) {
        animation-delay: 0.4s;
    }
    
    @keyframes typing-dot {
        0%, 80%, 100% { transform: scale(0.6); }
        40% { transform: scale(1); }
    }
</style>
{% endblock %}

{% block content %}
<!-- Animated Hero Section -->
<section class="hero-animated">
    <!-- Matrix rain canvas -->
    <canvas id="matrix-bg" class="matrix-canvas"></canvas>
    
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <div class="hero-content">
                    <h1 class="display-4 fw-bold mb-4 typed-text">{{ _('Welcome to SaaS Shop') }}</h1>
                    <p class="lead mb-4">{{ _('Discover amazing products with AI-powered shopping experience') }}</p>
                    <a href="{{ url_for('main.shop') }}" class="btn btn-light btn-lg btn-glow">
                        <i class="fas fa-rocket me-2"></i>{{ _('Start Shopping') }}
                    </a>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="hero-cta float-element">
                    <div class="text-center">
                        <div class="cta-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h3 class="mb-3">{{ _('AI-Powered Shopping') }}</h3>
                        <p class="mb-4">{{ _('Experience the future of online shopping with our intelligent recommendation system and AI assistant') }}</p>
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('main.shop') }}" class="btn btn-primary">
                                <i class="fas fa-shopping-bag me-2"></i>{{ _('Explore Products') }}
                            </a>
                            <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#chatModal">
                                <i class="fas fa-comment-dots me-2"></i>{{ _('Ask AI Assistant') }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Home Page Blocks -->
{% if blocks %}
<section class="py-5">
    <div class="container">
        <h2 class="text-center mb-5">{{ _('Explore Our Sections') }}</h2>
        <div class="row">
            {% for block in blocks %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 {{ block.css_class or '' }}" onclick="openBlock('{{ block.block_type }}', {{ block.id }})">
                    {% if block.image %}
                    <img src="{{ url_for('static', filename='uploads/' + block.image) }}" class="card-img-top" alt="{{ block.get_title(language) }}">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ block.get_title(language) }}</h5>
                        <p class="card-text">
                            {% if block.block_type == 'shop' %}
                                {{ _('Browse our product categories') }}
                            {% else %}
                                {{ _('Read our latest articles') }}
                            {% endif %}
                        </p>
                    </div>
                    <div class="card-footer text-center">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Featured Products -->
{% if featured_products %}
<section class="py-5 bg-light">
    <div class="container">
        <h2 class="text-center mb-5">{{ _('Featured Products') }}</h2>
        <div class="row">
            {% for product in featured_products %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100">
                    {% if product.image %}
                    <img src="{{ url_for('static', filename='uploads/' + product.image) }}" class="card-img-top" alt="{{ product.get_name(language) }}">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ product.get_name(language) }}</h5>
                        <p class="card-text">{{ product.get_description(language)[:100] }}...</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="h5 text-primary">{{ product.price }} {{ product.currency }}</span>
                            <button class="btn btn-primary btn-sm" onclick="addToCart({{ product.id }})">
                                <i class="fas fa-cart-plus"></i> {{ _('Add to Cart') }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Latest Blog Posts -->
{% if latest_posts %}
<section class="py-5">
    <div class="container">
        <h2 class="text-center mb-5">{{ _('Latest Articles') }}</h2>
        <div class="row">
            {% for post in latest_posts %}
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    {% if post.image %}
                    <img src="{{ url_for('static', filename='uploads/' + post.image) }}" class="card-img-top" alt="{{ post.get_title(language) }}">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ post.get_title(language) }}</h5>
                        <p class="card-text">
                            {% set excerpt = post.get_excerpt(language) %}
                            {% set content = post.get_content(language) %}
                            {{ excerpt or (content[:150] + '...' if content else '') }}
                        </p>
                        <p class="card-text"><small class="text-muted">{{ post.created_at.strftime('%d.%m.%Y') }}</small></p>
                    </div>
                    <div class="card-footer">
                        <a href="{{ url_for('main.blog_post', slug=post.slug) }}" class="btn btn-outline-primary">
                            {{ _('Read More') }}
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Features Section with Matrix Background -->
<section class="features-matrix position-relative py-5 text-white">
    <!-- Matrix rain canvas for features section -->
    <canvas id="features-matrix-bg" class="matrix-canvas"></canvas>
    
    <div class="container position-relative" style="z-index: 2;">
        <h2 class="text-center mb-5">{{ _('Why Choose Us?') }}</h2>
        <div class="row">
            <div class="col-md-4 text-center mb-4">
                <div class="feature-card">
                    <i class="fas fa-robot fa-3x mb-3"></i>
                    <h4>{{ _('AI-Powered Assistant') }}</h4>
                    <p>{{ _('Get personalized recommendations and instant support from our AI chatbot') }}</p>
                </div>
            </div>
            <div class="col-md-4 text-center mb-4">
                <div class="feature-card">
                    <i class="fas fa-shield-alt fa-3x mb-3"></i>
                    <h4>{{ _('Secure Payments') }}</h4>
                    <p>{{ _('Shop with confidence using our secure Stripe payment system') }}</p>
                </div>
            </div>
            <div class="col-md-4 text-center mb-4">
                <div class="feature-card">
                    <i class="fas fa-globe fa-3x mb-3"></i>
                    <h4>{{ _('Multilingual Support') }}</h4>
                    <p>{{ _('Available in Ukrainian, Russian, and German languages') }}</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- AI Chat Assistant Modal -->
<div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="chatModalLabel">
                    <i class="fas fa-robot me-2"></i>{{ _('AI Assistant') }}
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="chat-messages" class="mb-3" style="height: 300px; overflow-y: auto;">
                    <div class="d-flex mb-3">
                        <div class="flex-shrink-0">
                            <i class="fas fa-robot text-primary fs-4"></i>
                        </div>
                        <div class="flex-grow-1 ms-3 p-3 rounded" style="background-color: #f8f9fa;">
                            {{ _('Hello! How can I help you today? Ask me about our products or services.') }}
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" id="chat-input" class="form-control" placeholder="{{ _('Type your message...') }}">
                    <button class="btn btn-primary" type="button" id="send-message">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function openBlock(blockType, blockId) {
    if (blockType === 'shop') {
        window.location.href = "{{ url_for('main.shop') }}";
    } else if (blockType === 'blog') {
        window.location.href = "{{ url_for('main.blog') }}";
    }
}

// Simple typing effect for the hero heading
document.addEventListener('DOMContentLoaded', function() {
    const typedElement = document.querySelector('.typed-text');
    if (!typedElement) return;
    
    const originalText = typedElement.textContent;
    typedElement.textContent = '';
    
    let i = 0;
    function typeWriter() {
        if (i < originalText.length) {
            typedElement.textContent += originalText.charAt(i);
            i++;
            setTimeout(typeWriter, 100);
        } else {
            typedElement.classList.remove('typed-text');
        }
    }
    
    setTimeout(typeWriter, 500);
});

// Initialize Matrix Rain animations
document.addEventListener('DOMContentLoaded', function() {
    // Initialize main hero matrix rain
    if (document.getElementById('matrix-bg')) {
        const heroMatrixRain = new MatrixRain('matrix-bg', {
            fontSize: 14,
            color: 'rgba(0, 123, 255, 0.7)',
            backgroundColor: 'rgba(0, 0, 0, 0.03)',
            speed: 1,
            density: 0.98
        });
    }
    
    // Initialize features section matrix rain
    if (document.getElementById('features-matrix-bg')) {
        const featuresMatrixRain = new MatrixRain('features-matrix-bg', {
            fontSize: 12,
            color: 'rgba(0, 225, 255, 0.5)',
            backgroundColor: 'rgba(0, 0, 0, 0.05)',
            speed: 0.8,
            density: 0.95
        });
    }
});

// Simple chat functionality
document.addEventListener('DOMContentLoaded', function() {
    const chatInput = document.getElementById('chat-input');
    const sendButton = document.getElementById('send-message');
    const chatMessages = document.getElementById('chat-messages');
    
    if (!chatInput || !sendButton || !chatMessages) return;
    
    function addMessage(text, isUser = false) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'd-flex mb-3' + (isUser ? ' justify-content-end' : '');
        
        const innerHtml = isUser ? 
            `<div class="flex-grow-1 me-3 p-3 rounded text-white" style="background-color: var(--primary-color);">
                ${text}
            </div>
            <div class="flex-shrink-0">
                <i class="fas fa-user fs-4"></i>
            </div>` : 
            `<div class="flex-shrink-0">
                <i class="fas fa-robot text-primary fs-4"></i>
            </div>
            <div class="flex-grow-1 ms-3 p-3 rounded" style="background-color: #f8f9fa;">
                ${text}
            </div>`;
        
        messageDiv.innerHTML = innerHtml;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    async function getAIResponse(message) {
        try {
            const currentLanguage = document.documentElement.lang || 'uk';
            
            const response = await fetch('/api/chatbot', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: message,
                    language: currentLanguage
                })
            });
            
            const data = await response.json();
            
            if (data.response) {
                return data.response;
            } else {
                return "{{ _('Sorry, I could not process your request right now.') }}";
            }
        } catch (error) {
            console.error('Error calling chatbot API:', error);
            return "{{ _('Sorry, there was an error connecting to the server.') }}";
        }
    }
    
    async function sendMessage() {
        const message = chatInput.value.trim();
        if (!message) return;
        
        addMessage(message, true);
        chatInput.value = '';
        
        const typingDiv = document.createElement('div');
        typingDiv.className = 'd-flex mb-3';
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = `
            <div class="flex-shrink-0">
                <i class="fas fa-robot text-primary fs-4"></i>
            </div>
            <div class="flex-grow-1 ms-3 p-3 rounded" style="background-color: #f8f9fa;">
                <div class="typing-dots">
                    <span>.</span><span>.</span><span>.</span>
                </div>
            </div>
        `;
        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        const aiResponse = await getAIResponse(message);
        
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
            typingIndicator.remove();
        }
        
        addMessage(aiResponse, false);
    }
    
    sendButton.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
});
</script>

<!-- Matrix Rain Animation -->
<script src="{{ url_for('static', filename='js/matrix-rain.js') }}"></script>
{% endblock %}
