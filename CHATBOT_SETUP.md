# Инструкция по настройке OpenAI Assistant для чатбота

## 1. Получение API ключа OpenAI

1. Перейдите на https://platform.openai.com/api-keys
2. Войдите в свой аккаунт OpenAI
3. Создайте новый API ключ
4. Скопируйте ключ и сохраните в безопасном месте

## 2. Создание Assistant в OpenAI

1. Перейдите на https://platform.openai.com/assistants
2. Нажмите "Create Assistant"
3. Заполните следующие поля:

### Основные настройки:
- **Name**: Магазин-консультант
- **Instructions**: Скопируйте и вставьте инструкции ниже
- **Model**: gpt-4-turbo-preview (рекомендуется) или gpt-3.5-turbo

### Инструкции для Assistant:

```
Ты - AI-консультант интернет-магазина. Твоя основная задача - помочь покупателям найти нужные товары и мотивировать их к покупке.

ПРАВИЛА РАБОТЫ:
1. Всегда отвечай дружелюбно и профессионально
2. Отвечай на том языке, на котором к тебе обратился клиент (украинский, русский, немецкий, английский)
3. Используй информацию о товарах и категориях, предоставленную в контексте
4. Рекомендуй подходящие товары основываясь на потребностях клиента
5. Задавай уточняющие вопросы, чтобы лучше понять потребности
6. Предлагай альтернативы, если точного товара нет
7. Мотивируй к покупке, рассказывая о преимуществах товаров
8. Будь краток - отвечай в 1-3 предложениях, если не требуется детальное объяснение

СЦЕНАРИИ ОТВЕТОВ:
- Приветствие: "Привет! Я твой персональный помощник по покупкам. Как могу помочь найти идеальный товар?"
- Поиск товара: задавай уточняющие вопросы о бюджете, предпочтениях, назначении
- Рекомендации: предлагай 2-3 лучших варианта с кратким описанием преимуществ
- Завершение: мотивируй к действию "Хотел бы добавить что-то в корзину?"

Помни: твоя цель - не просто ответить на вопрос, а помочь клиенту совершить покупку, которая его удовлетворит.
```

### Дополнительные настройки:
- **Functions**: Оставьте пустым (мы используем контекст через сообщения)
- **Code Interpreter**: Отключить
- **Retrieval**: Отключить
- **File Search**: Отключить

4. Нажмите "Save"
5. Скопируйте Assistant ID (начинается с "asst_")

## 3. Настройка переменных окружения

Откройте файл `.env` и обновите следующие строки:

```env
OPENAI_API_KEY=sk-ваш-реальный-ключ-здесь
OPENAI_ASSISTANT_ID=asst-ваш-assistant-id-здесь
```

Замените:
- `sk-ваш-реальный-ключ-здесь` на ваш реальный API ключ от OpenAI
- `asst-ваш-assistant-id-здесь` на ID созданного Assistant

## 4. Тестирование

1. Перезапустите сервер: `python run.py`
2. Откройте любую страницу сайта
3. Найдите иконку чатбота (обычно справа внизу)
4. Отправьте тестовое сообщение, например: "Привет, что у вас есть?"

## 5. Мониторинг использования

1. Следите за использованием API на https://platform.openai.com/usage
2. Установите лимиты расходов в настройках аккаунта
3. Рекомендуется начать с лимита $10-20 в месяц для тестирования

## 6. Оптимизация затрат

- Используйте gpt-3.5-turbo вместо gpt-4 для экономии
- Ограничьте количество токенов в ответах
- Настройте таймауты для долгих запросов
- Регулярно очищайте старые threads в базе данных

## Примеры вопросов для тестирования:

- "Что у вас есть в категории электроника?"
- "Мне нужен подарок для девушки до 1000 грн"
- "Какой самый популярный товар?"
- "Есть ли у вас скидки?"
- "Можете посоветовать что-то для дома?"

## Устранение проблем:

1. **Error: The api_key client option must be set**
   - Проверьте, что API ключ правильно указан в .env
   - Перезапустите сервер

2. **Error: Assistant not found**
   - Проверьте правильность Assistant ID
   - Убедитесь, что Assistant не был удален

3. **Нет ответа от чатбота**
   - Проверьте интернет-соединение
   - Проверьте лимиты API на платформе OpenAI
   - Посмотрите логи сервера для детальной ошибки
